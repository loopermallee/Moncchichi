# 🧠 Moncchichi Hub — Context Engineering Document

> **Purpose:**  
> This file is the single source of truth shared between **ChatGPT** (project brain) and **Codex** (engineer).  
> It defines project context, current phase, milestones, known issues, and AI-generated solutions.  
> Both agents update this file continuously to maintain alignment.

---

## 📍 Project Context

Moncchichi Hub is the Android companion and AI interface for **Even Realities G1 Smart Glasses**.  
It connects hardware telemetry (battery, firmware, lens data) and conversational AI assistance (OpenAI GPT-4o-mini) into a unified, privacy-centric experience.

**Architecture Layers**
1. **Hub Layer** — BLE connection to G1 glasses, telemetry, device status.
2. **Assistant Layer** — GPT-powered reasoning, offline fallback, contextual replies.
3. **Service Layer** — Persistent BLE + assistant keepalive background process.

**Core Design Goals**
- Reliable BLE connection and recovery
- Offline fallback with cached replies
- Local-only preferences (no analytics)
- Minimal UI matching Even Realities aesthetic
- Simple extensibility for future modules (HUD, Voice, Cloud Sync)

---

## 🎯 Current Phase (Phase 3.8 — Clairvoyant Workflow)

**Objective**  
Unify BLE and LLM layers, refine assistant-device communication, simplify UI, and ensure stable offline fallback.

**Key Deliverables**
- Merge BLE telemetry pipeline with Assistant state banner  
- Integrate GPT-4o-mini as fixed model  
- Validate `ApiKeyValidator.kt` for `sk-proj-...` keys  
- Implement status-synced UI banner  
- Ensure assistant contextualizes device state  
- Maintain 100% local preference storage  

**Exit Criteria**
- BLE → Assistant → HUD data flow verified end-to-end  
- Offline fallback stable  
- No app crashes after idle reconnect  

---

## 🧩 Active Milestones

| # | Milestone | Owner | Status | Notes |
|---|------------|--------|--------|-------|
| 1 | GPT-4o-mini hard-locked | Codex | ✅ | Integrated |
| 2 | Unified Assistant + Device banner | Codex | ✅ | Verified |
| 3 | API key validation for `sk-proj-*` | Codex | ✅ | Done |
| 4 | Offline fallback stable | Codex | ✅ | Stable |
| 5 | Simplified Settings screen | Codex | ✅ | Completed |
| 6 | BLE data stubs replaced with real telemetry | Codex | 🟡 | In progress |
| 7 | Assistant contextual replies using device data | ChatGPT | 🟡 | Pending review |
| 8 | BLE crash handling tests | Codex | 🔜 | Planned |
| 9 | LLM response refinement (Phase 4 preview) | ChatGPT | 🔜 | To schedule |

---

## 🧱 Known Issues / Errors

*(Auto-filled by Codex or GitHub CI)*  
- [ ] BLE telemetry returning `null` for firmware version  
- [ ] Occasional `java.io.IOException` during reconnect  
- [ ] Assistant responses not yet referencing device state  
- [ ] Intermittent HUD sync delay  

---

## 💡 ChatGPT Solutions / Ideas

*(Generated by ChatGPT after reading above section)*  
- Propose integrating **coroutine retries** for BLE reconnects (with exponential backoff).  
- Suggest creating a `TelemetryRepository.kt` to abstract BLE data for Assistant layer.  
- Implement a **context injection service** to feed device info into LLM prompt template.  
- Add **HUD message queue** for delayed updates when BLE reconnects mid-response.  
- Create **unit tests** for ApiKeyValidator.kt and BLE disconnection handling.

---

## 🧠 ChatGPT Responsibilities

1. Maintain this document’s overall structure and clarity.  
2. Generate updated **Phase summaries, solutions, and next steps**.  
3. Detect logic or design issues from error logs or Codex commits.  
4. Recommend architecture or UX refinements aligned with project goals.  

**Workflow Trigger:** After each Codex commit or CI run, ChatGPT reviews diff and updates:
- “Known Issues / Errors”
- “Solutions / Ideas”
- “Next Phase Preparation”

---

## 👨‍💻 Codex Responsibilities

1. Always read this document before coding.  
2. Follow current **Phase Objective** and **Milestones**.  
3. Append any new errors, warnings, or runtime logs under **Known Issues**.  
4. Commit code changes referencing the current phase (`phase-3.8`) in commit messages.  
5. When a milestone is complete, mark it ✅ and describe change briefly.

---

## 🔄 Feedback Loop

| Step | Action | Performed By |
|------|---------|--------------|
| 1 | Generate or refine context & milestones | ChatGPT |
| 2 | Implement code & update Known Issues | Codex |
| 3 | Review diffs and logs | ChatGPT |
| 4 | Introduce solutions and next steps | ChatGPT |
| 5 | Iterate until exit criteria met | Both |

---

## 🔭 Upcoming Phase (Phase 4 — BLE Core Fusion)

**Focus:** Replace stubbed BLE data with real device telemetry (battery %, firmware, MAC).  
**Targets:**  
- Stable two-way BLE read/write  
- Live HUD sync prototype  
- Color-coded debug console for BLE + LLM packets  

---

## 🧩 Technical Module Map

| Module | Purpose |
|---------|----------|
| **core/** | Shared UI, BLE models, LLM tools |
| **hub/** | Main app fragments (Dashboard, Chat, Settings) |
| **service/** | BLE connection + telemetry |
| **client/** | Future external or HUD clients |

---

## 🪶 Design Rules Recap
- Simplicity first — single-model logic, minimal toggles  
- Reliability over complexity — graceful recovery  
- Privacy-centric — local preferences only  
- Consistent Even Realities visual language  

---

## 🧾 Version History
| Version | Date | Summary |
|----------|------|----------|
| 3.8 | Oct 2025 | Merged BLE + LLM layers; offline fallback stable |
| 3.9 (Planned) | Nov 2025 | BLE live telemetry integration; assistant contextualization |

---

### ✅ End of Current Context
> This document is live. Codex updates logs and completions; ChatGPT updates goals and analysis.  
> All subsequent commits should reference this file before implementation.